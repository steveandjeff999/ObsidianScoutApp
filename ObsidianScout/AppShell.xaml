<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="ObsidianScout.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:ObsidianScout"
    xmlns:views="clr-namespace:ObsidianScout.Views"
    Title="ObsidianScout"
    FlyoutBehavior="Flyout"
    FlyoutBackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkBackground}}"
    FlyoutHeaderBehavior="CollapseOnScroll">

    <!-- Shell Styles and Item Template -->
    <Shell.Resources>
        <ResourceDictionary>
      
     <!-- Custom DataTemplate for Flyout Items -->
     <DataTemplate x:Key="FlyoutItemTemplate">
      <Grid HeightRequest="50" 
                      Padding="16,0">
          <Grid.ColumnDefinitions>
     <ColumnDefinition Width="Auto" />
         <ColumnDefinition Width="*" />
   </Grid.ColumnDefinitions>
      
    <!-- Icon placeholder (optional - can add icons later) -->
             <BoxView Grid.Column="0"
        WidthRequest="24"
         HeightRequest="24"
          BackgroundColor="Transparent"
        Margin="0,0,16,0"
           VerticalOptions="Center" />

                    <!-- Menu Item Text -->
   <Label Grid.Column="1"
       Text="{Binding Title}"
  FontSize="16"
         FontFamily="OpenSansRegular"
  VerticalOptions="Center"
       TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
   </Grid>
            </DataTemplate>
     
    <!-- FlyoutItem Style -->
            <Style TargetType="FlyoutItem" ApplyToDerivedTypes="True">
      <Setter Property="Shell.ItemTemplate" Value="{StaticResource FlyoutItemTemplate}" />
        </Style>
  
        </ResourceDictionary>
    </Shell.Resources>

    <!-- Custom Flyout Header -->
    <Shell.FlyoutHeader>
    <Grid HeightRequest="200" 
      BackgroundColor="{StaticResource Primary}"
      Padding="20">
     <VerticalStackLayout VerticalOptions="End" Spacing="8">
              <Label Text="ObsidianScout"
                  FontSize="28"
              FontAttributes="Bold"
     TextColor="White" />
     <Label Text="FRC Scouting System"
  FontSize="14"
   TextColor="White"
        Opacity="0.9" />
            </VerticalStackLayout>
        </Grid>
    </Shell.FlyoutHeader>

    <!-- Login Page (Always visible) -->
 <FlyoutItem Title="Login" 
 IsVisible="{Binding IsLoggedOut}"
     Route="LoginPage"
     FlyoutItemIsVisible="{Binding IsLoggedOut}">
    <ShellContent ContentTemplate="{DataTemplate views:LoginPage}" />
    </FlyoutItem>

    <!-- Authenticated Pages (Hidden when logged out) -->
    <FlyoutItem Title="Home"
     IsVisible="{Binding IsLoggedIn}"
    Route="MainPage">
   <ShellContent ContentTemplate="{DataTemplate local:MainPage}" />
    </FlyoutItem>

    <FlyoutItem Title="Scouting"
    IsVisible="{Binding IsLoggedIn}"
      Route="ScoutingPage">
    <ShellContent ContentTemplate="{DataTemplate views:ScoutingPage}" />
    </FlyoutItem>

    <FlyoutItem Title="Teams"
   IsVisible="{Binding IsLoggedIn}"
      Route="TeamsPage">
   <ShellContent ContentTemplate="{DataTemplate views:TeamsPage}" />
    </FlyoutItem>

    <FlyoutItem Title="Events"
           IsVisible="{Binding IsLoggedIn}"
                Route="EventsPage">
        <ShellContent ContentTemplate="{DataTemplate views:EventsPage}" />
    </FlyoutItem>

    <!-- Matches Page -->
    <FlyoutItem Title="Matches"
 IsVisible="{Binding IsLoggedIn}"
             Route="MatchesPage">
        <ShellContent ContentTemplate="{DataTemplate views:MatchesPage}" />
    </FlyoutItem>

    <!-- Analytics Pages -->
    <FlyoutItem Title="Graphs"
      IsVisible="{Binding IsLoggedIn}"
      Route="GraphsPage">
        <ShellContent ContentTemplate="{DataTemplate views:GraphsPage}" />
    </FlyoutItem>

    <FlyoutItem Title="Match Prediction"
    IsVisible="{Binding IsLoggedIn}"
       Route="MatchPredictionPage">
        <ShellContent ContentTemplate="{DataTemplate views:MatchPredictionPage}" />
    </FlyoutItem>

    <FlyoutItem Title="Server Data"
    IsVisible="{Binding IsLoggedIn}"
       Route="DataPage">
        <ShellContent ContentTemplate="{DataTemplate views:DataPage}" />
    </FlyoutItem>

    <!-- Chat -->
    <FlyoutItem Title="Chat" IsVisible="{Binding IsLoggedIn}" Route="ChatPage">
        <ShellContent ContentTemplate="{DataTemplate views:ChatPage}" />
    </FlyoutItem>

    <!-- Settings Page: move Route to ShellContent so Shell resolves route correctly -->
    <FlyoutItem Title="Settings"
        IsVisible="{Binding IsLoggedIn}">
        <ShellContent Route="SettingsPage" ContentTemplate="{DataTemplate views:SettingsPage}" />
    </FlyoutItem>

    <!-- Logout Footer -->
    <Shell.FlyoutFooter>
        <Grid Padding="12"
        IsVisible="{Binding IsLoggedIn}"
 BackgroundColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkSurface}}">
      <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12" VerticalOptions="Center">
 <VerticalStackLayout Grid.Column="0" Spacing="2" VerticalOptions="Center">
 <!-- Put tap on the Username label specifically for better hit testing -->
 <Label Text="{Binding CurrentUsername}" FontSize="14" FontAttributes="Bold" TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}">
 <Label.GestureRecognizers>
 <TapGestureRecognizer Tapped="OnUserTapped" NumberOfTapsRequired="1" />
 </Label.GestureRecognizers>
 </Label>
 <Label Text="{Binding CurrentTeamInfo}" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource TextTertiary}, Dark={StaticResource DarkTextSecondary}}" />
 </VerticalStackLayout>

 <!-- Logout button only (offline toggle moved to Settings) -->
 <HorizontalStackLayout Grid.Column="1" Spacing="8" VerticalOptions="Center">
 <Button Text="Logout"
 Style="{StaticResource OutlineGlassButton}"
 Clicked="OnLogoutClicked" HorizontalOptions="End" />
 </HorizontalStackLayout>
 </Grid>
    </Grid>
    </Shell.FlyoutFooter>

</Shell>
