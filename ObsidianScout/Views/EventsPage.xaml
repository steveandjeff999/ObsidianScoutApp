<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
      xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
  xmlns:viewmodels="clr-namespace:ObsidianScout.ViewModels"
   xmlns:models="clr-namespace:ObsidianScout.Models"
      x:Class="ObsidianScout.Views.EventsPage"
        x:DataType="viewmodels:EventsViewModel"
             Title="Events">

    <Grid RowDefinitions="Auto,*">
        
        <!-- Header Card -->
        <Border Grid.Row="0"
      Style="{StaticResource CompactGlassCard}"
  Margin="20,20,20,10">
<Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
      <Label Grid.Column="0"
     Text="Events"
  Style="{StaticResource HeaderLabel}"
       VerticalOptions="Center" />
     
    <Button Grid.Column="1"
    Text="â†»"
  Style="{StaticResource IconButton}"
             Command="{Binding RefreshCommand}"
   IsEnabled="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}" />
       </Grid>
        </Border>

  <!-- Content -->
    <RefreshView Grid.Row="1"
            IsRefreshing="{Binding IsRefreshing}"
    Command="{Binding RefreshCommand}">
         
      <CollectionView ItemsSource="{Binding Events}"
         SelectionMode="None"
        Margin="20,0,20,20">
                
<CollectionView.EmptyView>
 <VerticalStackLayout Spacing="20"
          Padding="40"
         VerticalOptions="Center">

    <!-- Loading State -->
   <VerticalStackLayout Spacing="16"
HorizontalOptions="Center"
          IsVisible="{Binding IsLoading}">
 <ActivityIndicator IsRunning="True"
               HeightRequest="50"
        WidthRequest="50" />
   <Label Text="Loading events..."
      Style="{StaticResource BodyLabel}"
         HorizontalTextAlignment="Center" />
      </VerticalStackLayout>

        <!-- Empty State -->
      <VerticalStackLayout Spacing="16"
      HorizontalOptions="Center"
     IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}">
          <Label Text="ðŸ“…"
 FontSize="64"
        HorizontalTextAlignment="Center"
      Opacity="0.5" />
         <Label Text="No Events Found"
        Style="{StaticResource SubheaderLabel}"
    HorizontalTextAlignment="Center" />
        <Label Text="Pull down to refresh or check your connection"
      Style="{StaticResource CaptionLabel}"
           HorizontalTextAlignment="Center" />
       
        <!-- Error Message -->
        <Border IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}"
             Style="{StaticResource ErrorBadge}"
       HorizontalOptions="Center"
      Margin="0,10,0,0">
           <Label Text="{Binding ErrorMessage}"
  TextColor="White"
          FontSize="14"
             Padding="8,4" />
      </Border>
         </VerticalStackLayout>
         </VerticalStackLayout>
  </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="models:Event">
  <Border Style="{StaticResource GlassListItem}"
       BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}">
      <Border.GestureRecognizers>
        <TapGestureRecognizer 
           Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:EventsViewModel}}, Path=EventSelectedCommand}"
CommandParameter="{Binding .}" />
    </Border.GestureRecognizers>

     <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="16">
    
           <!-- Event Info -->
      <VerticalStackLayout Grid.Column="1"
   Spacing="4"
      VerticalOptions="Center">
     <Label Text="{Binding Name}"
         Style="{StaticResource SubheaderLabel}"
           FontSize="18"
  LineBreakMode="WordWrap"
   MaxLines="2" />
           <Label Text="{Binding Code}"
       Style="{StaticResource BodyLabel}"
           FontSize="14"
    Opacity="0.8"
   LineBreakMode="NoWrap" />
      <HorizontalStackLayout Spacing="8">
    <Label Text="ðŸ“" FontSize="12"
               VerticalOptions="Center" />
 <Label Text="{Binding Location}"
         Style="{StaticResource CaptionLabel}"
        FontSize="12"
          VerticalOptions="Center"
           LineBreakMode="TailTruncation"
                MaxLines="1" />
       </HorizontalStackLayout>
           <HorizontalStackLayout Spacing="8">
     <Label Text="ðŸ“…" FontSize="12"
          VerticalOptions="Center" />
  <Label Text="{Binding StartDate, StringFormat='{0:MMM dd, yyyy}'}"
       Style="{StaticResource CaptionLabel}"
 FontSize="12"
           VerticalOptions="Center"
        LineBreakMode="NoWrap" />
  </HorizontalStackLayout>
    </VerticalStackLayout>

       <!-- Team Count Badge -->
      <Border Grid.Column="2"
           Style="{StaticResource InfoBadge}"
         VerticalOptions="Center"
          IsVisible="{Binding TeamCount, Converter={StaticResource IntToBoolConverter}}">
      <Label Text="{Binding TeamCount, StringFormat='{0} teams'}"
TextColor="White"
     FontSize="12"
  FontFamily="OpenSansSemibold" />
        </Border>

  <!-- Chevron -->
         <Label Grid.Column="2"
          Text="â€º"
           FontSize="24"
     TextColor="{StaticResource TextTertiary}"
    VerticalOptions="Center"
                IsVisible="{Binding TeamCount, Converter={StaticResource IntToBoolConverter}, ConverterParameter=Invert}" />
        </Grid>
      </Border>
  </DataTemplate>
     </CollectionView.ItemTemplate>
            </CollectionView>
    </RefreshView>
    </Grid>

</ContentPage>
