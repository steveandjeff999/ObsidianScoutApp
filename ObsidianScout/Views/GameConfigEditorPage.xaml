<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
 x:Class="ObsidianScout.Views.GameConfigEditorPage"
 Title="Game Config Editor"
 BackgroundColor="{AppThemeBinding Light={StaticResource LightBackground}, Dark={StaticResource DarkBackground}}">

 <Grid RowDefinitions="Auto,*,Auto" Padding="12" RowSpacing="10">
 
 <!-- Top Buttons -->
 <HorizontalStackLayout Grid.Row="0" Spacing="8">
 <Button x:Name="RawButton" Text="Raw JSON" Clicked="OnShowRawClicked" 
 BackgroundColor="{AppThemeBinding Light={StaticResource LightPrimary}, Dark={StaticResource DarkPrimary}}" />
 <Button x:Name="FormButton" Text="Form Editor" Clicked="OnShowFormClicked" />
 <Button Text="Load" Command="{Binding LoadCommand}" />
 <Button Text="Save" Command="{Binding SaveCommand}" />
 <Button Text="Revert" Command="{Binding RevertCommand}" />
 </HorizontalStackLayout>

 <!-- Content Area -->
 <Grid Grid.Row="1">
 
<!-- Raw JSON View -->
 <ScrollView x:Name="RawScroll" IsVisible="True">
 <Editor x:Name="JsonEditor"
 Text="{Binding JsonText}"
 AutoSize="TextChanges"
 BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
 TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
 </ScrollView>

 <!-- Form Editor View -->
 <ScrollView x:Name="FormScroll" IsVisible="False">
 <VerticalStackLayout Spacing="16" Padding="8">

     <!-- Game Info Section -->
  <Frame Padding="12" CornerRadius="12"
        BackgroundColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkSurfaceVariant}}"
   BorderColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkBorder}}">
  <VerticalStackLayout Spacing="10">
       <Label Text="Game Info" FontSize="18" FontAttributes="Bold"
     TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />

      <Entry Text="{Binding CurrentConfig.GameName}" Placeholder="Game Name"
   BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
     TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
   
 <HorizontalStackLayout Spacing="12">
  <VerticalStackLayout>
      <Label Text="Season" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
     <Entry Text="{Binding CurrentConfig.Season}" WidthRequest="100" Keyboard="Numeric"
    BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
   TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
</VerticalStackLayout>
   <VerticalStackLayout>
  <Label Text="Alliance Size" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
     <Entry Text="{Binding CurrentConfig.AllianceSize}" WidthRequest="80" Keyboard="Numeric"
      BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
      TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
   </VerticalStackLayout>
     </HorizontalStackLayout>
    </VerticalStackLayout>
        </Frame>

     <!-- API & Event Configuration Section -->
  <Frame Padding="12" CornerRadius="12"
        BackgroundColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkSurfaceVariant}}"
   BorderColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkBorder}}">
  <VerticalStackLayout Spacing="10">
       <Label Text="API &amp; Event Configuration" FontSize="18" FontAttributes="Bold"
     TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />

    <!-- Current Event Code -->
      <VerticalStackLayout Spacing="4">
          <Label Text="Current Event Code" FontSize="12" FontAttributes="Bold"
             TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
    <Entry Text="{Binding CurrentConfig.CurrentEventCode}" Placeholder="e.g., EXREG,2025CAVE"
    BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
             TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
      </VerticalStackLayout>

      <!-- Version -->
   <VerticalStackLayout Spacing="4">
     <Label Text="Config Version" FontSize="12" FontAttributes="Bold"
         TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
        <Entry Text="{Binding CurrentConfig.Version}" Placeholder="e.g.,1.0.2"
             BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
      </VerticalStackLayout>

 <!-- Match Types (Comma-separated display) -->
      <VerticalStackLayout Spacing="4">
       <Label Text="Match Types (comma-separated)" FontSize="12" FontAttributes="Bold"
      TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
        <Entry Text="{Binding MatchTypesString}" Placeholder="Practice, Qualification, Playoff"
        BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
          <Label Text="Separate match types with commas" FontSize="10" FontAttributes="Italic"
    TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
      </VerticalStackLayout>

      <!-- API Credentials Section -->
      <BoxView HeightRequest="1" Color="{AppThemeBinding Light=#E0E0E0, Dark=#424242}" Margin="0,8" />
      
   <Label Text="API Configuration" FontSize="14" FontAttributes="Bold"
         TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
  
      <!-- Preferred API Source Picker -->
      <VerticalStackLayout Spacing="4">
   <Label Text="Preferred API Source" FontSize="12" FontAttributes="Bold"
    TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
        <Picker SelectedItem="{Binding CurrentConfig.PreferredApiSource}" 
    ItemsSource="{Binding ApiSourceOptions}"
      Title="Select API Source"
      Style="{StaticResource ModernPicker}"
 BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
  TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
      TitleColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
        <Label Text="Select which API to use for match/team data" FontSize="10" FontAttributes="Italic"
      TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
  </VerticalStackLayout>

      <!-- FIRST API Settings -->
   <Label Text="FIRST Robotics API" FontSize="13" FontAttributes="Bold" Margin="0,8,0,0"
             TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />

      <VerticalStackLayout Spacing="4">
        <Label Text="Username" FontSize="12"
   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
        <Entry Text="{Binding CurrentConfig.ApiSettings.Username}" Placeholder="FIRST API username"
     BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
       TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
      </VerticalStackLayout>

      <VerticalStackLayout Spacing="4">
   <Label Text="Auth Token" FontSize="12"
            TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
    <Entry Text="{Binding CurrentConfig.ApiSettings.AuthToken}" Placeholder="API authorization token" IsPassword="True"
               BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
      </VerticalStackLayout>

      <VerticalStackLayout Spacing="4">
        <Label Text="Base URL" FontSize="12"
        TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
   <Entry Text="{Binding CurrentConfig.ApiSettings.BaseUrl}" Placeholder="https://frc-api.firstinspires.org"
      BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
       TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
  </VerticalStackLayout>

      <HorizontalStackLayout Spacing="8">
        <Label Text="Auto-Sync Enabled:" VerticalOptions="Center" FontSize="12"
         TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
        <CheckBox IsChecked="{Binding CurrentConfig.ApiSettings.AutoSyncEnabled}" />
      </HorizontalStackLayout>

    <!-- TBA API Settings -->
      <Label Text="The Blue Alliance API" FontSize="13" FontAttributes="Bold" Margin="0,8,0,0"
             TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
      
      <VerticalStackLayout Spacing="4">
        <Label Text="Auth Key" FontSize="12"
           TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
        <Entry Text="{Binding CurrentConfig.TbaApiSettings.AuthKey}" Placeholder="TBA API key" IsPassword="True"
             BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
               TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
  </VerticalStackLayout>

      <VerticalStackLayout Spacing="4">
     <Label Text="Base URL" FontSize="12"
      TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
  <Entry Text="{Binding CurrentConfig.TbaApiSettings.BaseUrl}" Placeholder="https://www.thebluealliance.com/api/v3"
       BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
               TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
      </VerticalStackLayout>

</VerticalStackLayout>
        </Frame>

     <!-- Auto Period -->
    <VerticalStackLayout Spacing="8">
       <HorizontalStackLayout Spacing="12">
        <Label Text="Auto Period" FontSize="18" FontAttributes="Bold" VerticalOptions="Center"
   TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
   <Button Text="+ Add Element" Command="{Binding AddAutoElementCommand}"
   BackgroundColor="#4CAF50" TextColor="White" Padding="10,6" />
  </HorizontalStackLayout>
    
      <StackLayout BindableLayout.ItemsSource="{Binding AutoElements}" Spacing="8">
 <BindableLayout.ItemTemplate>
     <DataTemplate>
      <Frame Padding="12" CornerRadius="10"
BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurfaceVariant}}"
   BorderColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkBorder}}">
 <VerticalStackLayout Spacing="10">
   
        <!-- Header: Name + Delete -->
<Grid ColumnDefinitions="*,Auto">
      <Entry Grid.Column="0" Text="{Binding Name}" Placeholder="Element Name"
  BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
 TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
         <Button Grid.Column="1" Text="Delete"
       Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteElementCommand}"
    CommandParameter="{Binding}"
  BackgroundColor="#F44336" TextColor="White" Padding="8,4" FontSize="12" />
</Grid>

     <!-- Type Picker -->
      <HorizontalStackLayout Spacing="8">
      <Label Text="Type:" VerticalOptions="Center" WidthRequest="70"
      TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
       <Picker Title="Select Type"
               ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ElementTypes}"
      SelectedItem="{Binding Type}"
       WidthRequest="180"
 BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
     TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
      TitleColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
      </HorizontalStackLayout>

    <!-- Points (NOT shown for boolean or multiplechoice) -->
  <HorizontalStackLayout Spacing="8" IsVisible="{Binding Type, Converter={StaticResource NotBooleanOrMultipleChoiceConverter}}"> 
  <Label Text="Points:" VerticalOptions="Center" WidthRequest="70"
   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
     <Entry Text="{Binding Points}" WidthRequest="120" Keyboard="Numeric"
    BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
  TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
      </HorizontalStackLayout>

        <!-- Default for Counter -->
     <HorizontalStackLayout Spacing="8" IsVisible="{Binding Type, Converter={StaticResource StringEqualsConverter}, ConverterParameter=counter}">
      <Label Text="Default:" VerticalOptions="Center" WidthRequest="70"
TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
 <Entry Text="{Binding Default}" WidthRequest="120" Keyboard="Numeric"
      BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
          TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
              </HorizontalStackLayout>

     <!-- Default for Boolean -->
    <HorizontalStackLayout Spacing="8" IsVisible="{Binding Type, Converter={StaticResource StringEqualsConverter}, ConverterParameter=boolean}">
  <Label Text="Default:" VerticalOptions="Center" WidthRequest="70"
   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
  <Picker Title="Select Default"
           ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.BooleanOptions}"
     SelectedItem="{Binding Default}"
     WidthRequest="180"
 BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
  TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
         TitleColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
   </HorizontalStackLayout>

            <!-- Multiple Choice Options -->
     <VerticalStackLayout IsVisible="{Binding Type, Converter={StaticResource StringEqualsConverter}, ConverterParameter=multiplechoice}" Spacing="6">
   <HorizontalStackLayout Spacing="8">
    <Label Text="Options:" FontSize="13" FontAttributes="Bold"
    TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
 <Button Text="+ Add Option"
    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddOptionToElementCommand}"
   CommandParameter="{Binding}"
   BackgroundColor="#2196F3" TextColor="White" Padding="8,4" FontSize="11" />
     </HorizontalStackLayout>

     <StackLayout BindableLayout.ItemsSource="{Binding Options}" Spacing="6">
  <BindableLayout.ItemTemplate>
        <DataTemplate>
      <Frame Padding="8" CornerRadius="6" BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2C2C2C}">
           <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">
    <Entry Grid.Column="0" Text="{Binding Name}" Placeholder="Option Name"
BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
          TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
  <HorizontalStackLayout Grid.Column="1" Spacing="4">
       <Label Text="Pts:" VerticalOptions="Center" FontSize="12" 
  TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
       <Entry Text="{Binding Points}" WidthRequest="60" Keyboard="Numeric"
 BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
</HorizontalStackLayout>
        <Button Grid.Column="2" Text="Delete"
            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteOptionFromElementCommand}"
 CommandParameter="{Binding}"
      BackgroundColor="#F44336" TextColor="White"
   Padding="6,2" FontSize="10" WidthRequest="35" />
         </Grid>
  </Frame>
    </DataTemplate>
     </BindableLayout.ItemTemplate>
    </StackLayout>
     </VerticalStackLayout>

           </VerticalStackLayout>
    </Frame>
 </DataTemplate>
       </BindableLayout.ItemTemplate>
      </StackLayout>
   </VerticalStackLayout>

      <!-- Teleop Period (same as Auto) -->
         <VerticalStackLayout Spacing="8">
 <HorizontalStackLayout Spacing="12">
     <Label Text="Teleop Period" FontSize="18" FontAttributes="Bold" VerticalOptions="Center"
     TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
    <Button Text="+ Add Element" Command="{Binding AddTeleopElementCommand}"
    BackgroundColor="#4CAF50" TextColor="White" Padding="10,6" />
    </HorizontalStackLayout>
  
   <StackLayout BindableLayout.ItemsSource="{Binding TeleopElements}" Spacing="8">
<BindableLayout.ItemTemplate>
     <DataTemplate>
         <Frame Padding="12" CornerRadius="10"
       BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurfaceVariant}}"
       BorderColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkBorder}}">
         <VerticalStackLayout Spacing="10">
         <Grid ColumnDefinitions="*,Auto">
     <Entry Grid.Column="0" Text="{Binding Name}" Placeholder="Element Name"
        BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
  TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
      <Button Grid.Column="1" Text="Delete"
    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteElementCommand}"
   CommandParameter="{Binding}"
    BackgroundColor="#F44336" TextColor="White" Padding="8,4" FontSize="12" />
          </Grid>
      <HorizontalStackLayout Spacing="8">
       <Label Text="Type:" VerticalOptions="Center" WidthRequest="70"
   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
       <Picker Title="Select Type"
               ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ElementTypes}"
    SelectedItem="{Binding Type}"
         WidthRequest="180"
     BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
TitleColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
      </HorizontalStackLayout>
         <HorizontalStackLayout Spacing="8" IsVisible="{Binding Type, Converter={StaticResource NotBooleanOrMultipleChoiceConverter}}"> 
<Label Text="Points:" VerticalOptions="Center" WidthRequest="70"
TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
    <Entry Text="{Binding Points}" WidthRequest="120" Keyboard="Numeric"
      BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
        TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
 </HorizontalStackLayout>
  <HorizontalStackLayout Spacing="8" IsVisible="{Binding Type, Converter={StaticResource StringEqualsConverter}, ConverterParameter=counter}">
   <Label Text="Default:" VerticalOptions="Center" WidthRequest="70"
     TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
        <Entry Text="{Binding Default}" WidthRequest="120" Keyboard="Numeric"
   BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
    </HorizontalStackLayout>
  <HorizontalStackLayout Spacing="8" IsVisible="{Binding Type, Converter={StaticResource StringEqualsConverter}, ConverterParameter=boolean}">
     <Label Text="Default:" VerticalOptions="Center" WidthRequest="70"
TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
          <Picker Title="Select Default"
         ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.BooleanOptions}"
      SelectedItem="{Binding Default}"
         WidthRequest="180"
            BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
 TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
  TitleColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
     </HorizontalStackLayout>
<VerticalStackLayout IsVisible="{Binding Type, Converter={StaticResource StringEqualsConverter}, ConverterParameter=multiplechoice}" Spacing="6">
   <HorizontalStackLayout Spacing="8">
    <Label Text="Options:" FontSize="13" FontAttributes="Bold"
   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
 <Button Text="+ Add Option"
  Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddOptionToElementCommand}"
CommandParameter="{Binding}"
  BackgroundColor="#2196F3" TextColor="White" Padding="8,4" FontSize="11" />
        </HorizontalStackLayout>
 <StackLayout BindableLayout.ItemsSource="{Binding Options}" Spacing="6">
 <BindableLayout.ItemTemplate>
    <DataTemplate>
       <Frame Padding="8" CornerRadius="6" BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2C2C2C}">
          <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">
      <Entry Grid.Column="0" Text="{Binding Name}" Placeholder="Option Name"
       BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
    <HorizontalStackLayout Grid.Column="1" Spacing="4">
     <Label Text="Pts:" VerticalOptions="Center" FontSize="12"
  TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
 <Entry Text="{Binding Points}" WidthRequest="60" Keyboard="Numeric"
         BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
         TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
     </HorizontalStackLayout>
 <Button Grid.Column="2" Text="Delete"
  Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteOptionFromElementCommand}"
   CommandParameter="{Binding}"
       BackgroundColor="#F44336" TextColor="White"
  Padding="6,2" FontSize="10" WidthRequest="35" />
    </Grid>
       </Frame>
    </DataTemplate>
  </BindableLayout.ItemTemplate>
   </StackLayout>
   </VerticalStackLayout>
</VerticalStackLayout>
</Frame>
       </DataTemplate>
 </BindableLayout.ItemTemplate>
     </StackLayout>
       </VerticalStackLayout>

  <!-- Endgame Period (same as Auto and Teleop) -->
          <VerticalStackLayout Spacing="8">
    <HorizontalStackLayout Spacing="12">
     <Label Text="Endgame Period" FontSize="18" FontAttributes="Bold" VerticalOptions="Center"
    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
 <Button Text="+ Add Element" Command="{Binding AddEndgameElementCommand}"
   BackgroundColor="#4CAF50" TextColor="White" Padding="10,6" />
  </HorizontalStackLayout>

          <StackLayout BindableLayout.ItemsSource="{Binding EndgameElements}" Spacing="8">
       <BindableLayout.ItemTemplate>
        <DataTemplate>
        <Frame Padding="12" CornerRadius="10"
          BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurfaceVariant}}"
 BorderColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkBorder}}">
     <VerticalStackLayout Spacing="10">
 <Grid ColumnDefinitions="*,Auto">
      <Entry Grid.Column="0" Text="{Binding Name}" Placeholder="Element Name"
 BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
   TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
     <Button Grid.Column="1" Text="Delete"
 Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteElementCommand}"
            CommandParameter="{Binding}"
   BackgroundColor="#F44336" TextColor="White" Padding="8,4" FontSize="12" />
        </Grid>
 <HorizontalStackLayout Spacing="8">
     <Label Text="Type:" VerticalOptions="Center" WidthRequest="70"
   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
 <Picker Title="Select Type"
      ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ElementTypes}"
      SelectedItem="{Binding Type}"
      WidthRequest="180"
BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
   TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
TitleColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
     </HorizontalStackLayout>
  <HorizontalStackLayout Spacing="8" IsVisible="{Binding Type, Converter={StaticResource NotBooleanOrMultipleChoiceConverter}}"> 
  <Label Text="Points:" VerticalOptions="Center" WidthRequest="70"
 TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
      <Entry Text="{Binding Points}" WidthRequest="120" Keyboard="Numeric"
  BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
        TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
    </HorizontalStackLayout>
  <HorizontalStackLayout Spacing="8" IsVisible="{Binding Type, Converter={StaticResource StringEqualsConverter}, ConverterParameter=counter}">
   <Label Text="Default:" VerticalOptions="Center" WidthRequest="70"
   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
 <Entry Text="{Binding Default}" WidthRequest="120" Keyboard="Numeric"
  BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
      TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
     </HorizontalStackLayout>
      <HorizontalStackLayout Spacing="8" IsVisible="{Binding Type, Converter={StaticResource StringEqualsConverter}, ConverterParameter=boolean}">
   <Label Text="Default:" VerticalOptions="Center" WidthRequest="70"
        TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
           <Picker Title="Select Default"
         ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.BooleanOptions}"
    SelectedItem="{Binding Default}"
    WidthRequest="180"
     BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
     TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
   TitleColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
    </HorizontalStackLayout>
  <VerticalStackLayout IsVisible="{Binding Type, Converter={StaticResource StringEqualsConverter}, ConverterParameter=multiplechoice}" Spacing="6">
   <HorizontalStackLayout Spacing="8">
    <Label Text="Options:" FontSize="13" FontAttributes="Bold"
   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
 <Button Text="+ Add Option"
  Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddOptionToElementCommand}"
CommandParameter="{Binding}"
  BackgroundColor="#2196F3" TextColor="White" Padding="8,4" FontSize="11" />
        </HorizontalStackLayout>
 <StackLayout BindableLayout.ItemsSource="{Binding Options}" Spacing="6">
 <BindableLayout.ItemTemplate>
    <DataTemplate>
       <Frame Padding="8" CornerRadius="6" BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2C2C2C}">
          <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">
      <Entry Grid.Column="0" Text="{Binding Name}" Placeholder="Option Name"
       BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
    <HorizontalStackLayout Grid.Column="1" Spacing="4">
     <Label Text="Pts:" VerticalOptions="Center" FontSize="12"
  TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
 <Entry Text="{Binding Points}" WidthRequest="60" Keyboard="Numeric"
         BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
         TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
     </HorizontalStackLayout>
 <Button Grid.Column="2" Text="Delete"
  Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteOptionFromElementCommand}"
   CommandParameter="{Binding}"
       BackgroundColor="#F44336" TextColor="White"
  Padding="6,2" FontSize="10" WidthRequest="35" />
    </Grid>
       </Frame>
    </DataTemplate>
  </BindableLayout.ItemTemplate>
   </StackLayout>
   </VerticalStackLayout>
</VerticalStackLayout>
</Frame>
       </DataTemplate>
 </BindableLayout.ItemTemplate>
     </StackLayout>
       </VerticalStackLayout>

   <!-- Post Match Ratings -->
      <VerticalStackLayout Spacing="8">
     <HorizontalStackLayout Spacing="12">
      <Label Text="Post Match - Ratings" FontSize="18" FontAttributes="Bold" VerticalOptions="Center"
            TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
            <Button Text="+ Add Rating" Command="{Binding AddRatingElementCommand}"
     BackgroundColor="#FF9800" TextColor="White" Padding="10,6" />
  </HorizontalStackLayout>
   
   <StackLayout BindableLayout.ItemsSource="{Binding PostMatchRatingElements}" Spacing="8">
    <BindableLayout.ItemTemplate>
     <DataTemplate>
      <Frame Padding="12" CornerRadius="10"
         BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurfaceVariant}}"
           BorderColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkBorder}}">
   <VerticalStackLayout Spacing="10">
         
          <!-- Header: Name + Delete -->
      <Grid ColumnDefinitions="*,Auto">
           <Entry Grid.Column="0" Text="{Binding Name}" Placeholder="Rating Name"
 BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
  TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
           <Button Grid.Column="1" Text="Delete"
           Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteRatingElementCommand}"
         CommandParameter="{Binding}"
         BackgroundColor="#F44336" TextColor="White" Padding="8,4" FontSize="12" />
            </Grid>
          
     <!-- Min/Max/Default Grid -->
     <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
 <VerticalStackLayout Grid.Column="0">
           <Label Text="Min" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
           <Entry Text="{Binding Min}" Keyboard="Numeric"
            BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
       </VerticalStackLayout>
    <VerticalStackLayout Grid.Column="1">
       <Label Text="Max" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
       <Entry Text="{Binding Max}" Keyboard="Numeric"
             BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
     TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
        </VerticalStackLayout>
       <VerticalStackLayout Grid.Column="2">
      <Label Text="Default" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
                <Entry Text="{Binding Default}" Keyboard="Numeric"
     BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
 TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
      </VerticalStackLayout>
    </Grid>
   
          </VerticalStackLayout>
  </Frame>
      </DataTemplate>
    </BindableLayout.ItemTemplate>
       </StackLayout>
   </VerticalStackLayout>

     <!-- Post Match Text -->
      <VerticalStackLayout Spacing="8">
 <HorizontalStackLayout Spacing="12">
            <Label Text="Post Match - Text" FontSize="18" FontAttributes="Bold" VerticalOptions="Center"
         TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
    <Button Text="+ Add Text Field" Command="{Binding AddTextElementCommand}"
   BackgroundColor="#9C27B0" TextColor="White" Padding="10,6" />
 </HorizontalStackLayout>
 
<StackLayout BindableLayout.ItemsSource="{Binding PostMatchTextElements}" Spacing="8">
        <BindableLayout.ItemTemplate>
   <DataTemplate>
      <Frame Padding="12" CornerRadius="10"
     BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurfaceVariant}}"
  BorderColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkBorder}}">
     <VerticalStackLayout Spacing="10">
            
   <!-- Header: Name + Delete -->
      <Grid ColumnDefinitions="*,Auto">
   <Entry Grid.Column="0" Text="{Binding Name}" Placeholder="Text Field Name"
            BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
        TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}" />
     <Button Grid.Column="1" Text="Delete"
   Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteTextElementCommand}"
       CommandParameter="{Binding}"
     BackgroundColor="#F44336" TextColor="White" Padding="8,4" FontSize="12" />
        </Grid>
     
      <!-- Multiline Toggle -->
        <HorizontalStackLayout Spacing="8">
     <Label Text="Multiline:" VerticalOptions="Center"
 TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />
  <CheckBox IsChecked="{Binding Multiline}" />
      </HorizontalStackLayout>
  
     </VerticalStackLayout>
 </Frame>
    </DataTemplate>
   </BindableLayout.ItemTemplate>
        </StackLayout>
   </VerticalStackLayout>

 </VerticalStackLayout>
     </ScrollView>
 </Grid>  <!-- Close inner Grid Grid.Row="1" -->

 <!-- Status -->
    <Label Grid.Row="2" Text="{Binding StatusMessage}" HorizontalOptions="Center" FontSize="12"
  TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}" />

    </Grid>  <!-- Close outer Grid with RowDefinitions -->
</ContentPage>