<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
  xmlns:vm="clr-namespace:ObsidianScout.ViewModels"
    xmlns:models="clr-namespace:ObsidianScout.Models"
          x:Class="ObsidianScout.Views.PitScoutingPage"
    Title="Pit Scouting"
             x:DataType="vm:PitScoutingViewModel">

    <Grid RowDefinitions="Auto,*,Auto" Padding="16">
        
     <!-- Header -->
   <VerticalStackLayout Grid.Row="0" Spacing="12">
       
            <!-- Title -->
            <Label Text="{Binding PitConfig.PitScouting.Title, FallbackValue='Pit Scouting'}"
          FontSize="24"
       FontAttributes="Bold"
            HorizontalOptions="Center"/>

       <!-- Description -->
          <Label Text="{Binding PitConfig.PitScouting.Description}"
       FontSize="14"
        TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"
    HorizontalOptions="Center"
         IsVisible="{Binding PitConfig.PitScouting.Description, Converter={StaticResource IsNotNullOrEmptyConverter}}"/>

            <!-- Scout Name -->
            <Entry Placeholder="Scout Name"
         Text="{Binding ScoutName}"
           FontSize="16"/>

  <!-- Team Picker -->
            <Picker Title="Select Team"
     ItemsSource="{Binding Teams}"
  SelectedItem="{Binding SelectedTeam}"
   FontSize="16">
     <Picker.ItemDisplayBinding>
 <Binding Path="TeamNumber" StringFormat="Team {0}"/>
     </Picker.ItemDisplayBinding>
   </Picker>

            <!-- View History Button (shown when team is selected) -->
<Button Text="View History"
     Command="{Binding ViewHistoryCommand}"
     IsVisible="{Binding SelectedTeam, Converter={StaticResource IsNotNullConverter}}"
      Margin="0,8,0,0"
         Style="{StaticResource SecondaryButtonStyle}"/>

 <!-- Status Message -->
            <Label Text="{Binding StatusMessage}"
       FontSize="14"
 TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
    HorizontalOptions="Center"
     IsVisible="{Binding StatusMessage, Converter={StaticResource IsNotNullOrEmptyConverter}}"/>

  <!--  Loading Indicator -->
       <ActivityIndicator IsRunning="{Binding IsLoading}"
    IsVisible="{Binding IsLoading}"
 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"/>

 </VerticalStackLayout>

   <!-- Scrollable Form Content -->
<ScrollView Grid.Row="1" Margin="0,16,0,0">
  <VerticalStackLayout Spacing="24" x:Name="FormContainer"/>
        </ScrollView>

        <!-- Action Buttons -->
        <Grid Grid.Row="2"
   ColumnDefinitions="*,*"
  ColumnSpacing="12"
          Margin="0,16,0,0">

          <Button Grid.Column="0"
Text="Reset"
 Command="{Binding ResetCommand}"
       Style="{StaticResource SecondaryButtonStyle}"/>

   <Button Grid.Column="1"
         Text="Submit"
          Command="{Binding SubmitCommand}"
Style="{StaticResource PrimaryButtonStyle}"/>

        </Grid>

    <!-- History Overlay -->
    <Grid Grid.RowSpan="3"
IsVisible="{Binding IsViewingHistory}"
         BackgroundColor="{AppThemeBinding Light=#F0FFFFFF, Dark=#F0000000}">
      
          <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
    StrokeThickness="1"
       Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray700}}"
   Margin="16"
      StrokeShape="RoundRectangle 16"
    Padding="16">
   <Border.Shadow>
           <Shadow Brush="{AppThemeBinding Light=Black, Dark=Transparent}"
    Opacity="0.2"
     Radius="20"/>
       </Border.Shadow>
       
        <Grid RowDefinitions="Auto,*,Auto">
    
    <!-- Header -->
     <VerticalStackLayout Grid.Row="0" Spacing="8">
 <Label Text="Pit Scouting History"
       FontSize="20"
   FontAttributes="Bold"
     HorizontalOptions="Center"/>
  
 <Label Text="{Binding SelectedTeam.TeamNumber, StringFormat='Team {0}'}"
       FontSize="16"
         HorizontalOptions="Center"
     Opacity="0.7"/>
           </VerticalStackLayout>
   
        <!-- History List -->
        <CollectionView Grid.Row="1"
      ItemsSource="{Binding HistoryEntries}"
        Margin="0,16,0,16">
       <CollectionView.EmptyView>
      <Label Text="No pit scouting data found for this team"
 HorizontalOptions="Center"
        VerticalOptions="Center"
       Opacity="0.6"/>
      </CollectionView.EmptyView>
      
         <CollectionView.ItemTemplate>
     <DataTemplate x:DataType="models:PitScoutingEntry">
     <Border BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2A2A2A}"
         StrokeThickness="0"
           Padding="12"
       Margin="0,4"
     StrokeShape="RoundRectangle 8">
 <Border.GestureRecognizers>
         <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:PitScoutingViewModel}}, Path=EditEntryCommand}"
     CommandParameter="{Binding .}"/>
         </Border.GestureRecognizers>
     
   <Grid ColumnDefinitions="*,Auto">
    <VerticalStackLayout Grid.Column="0" Spacing="4">
                <Label Text="{Binding TeamName}"
             FontSize="16"
       FontAttributes="Bold"/>
          
             <Label Text="{Binding Timestamp, StringFormat='{0:g}'}"
        FontSize="14"
         Opacity="0.7"/>
 
              <Label Text="{Binding ScoutName, StringFormat='Scout: {0}'}"
          FontSize="14"
        Opacity="0.7"
            IsVisible="{Binding ScoutName, Converter={StaticResource IsNotNullOrEmptyConverter}}"/>
          </VerticalStackLayout>
           
       <Label Grid.Column="1"
     Text="Edit >"
            FontSize="14"
   VerticalOptions="Center"
                TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"/>
   </Grid>
         </Border>
                </DataTemplate>
           </CollectionView.ItemTemplate>
       </CollectionView>
     
 <!-- Close Button -->
             <Button Grid.Row="2"
         Text="Close"
         Command="{Binding CloseHistoryCommand}"
     Style="{StaticResource SecondaryButtonStyle}"/>
  
       </Grid>
        </Border>
        </Grid>

    </Grid>

</ContentPage>
