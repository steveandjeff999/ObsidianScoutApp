<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:ObsidianScout.Models"
      x:Class="ObsidianScout.Views.DataPage"
         Title="Server Data">

    <Grid RowDefinitions="Auto,*" Padding="20" RowSpacing="20">

  <!-- HEADER SECTION -->
     <Border Grid.Row="0" Style="{StaticResource CompactGlassCard}">
            <VerticalStackLayout Spacing="8">
   <HorizontalStackLayout Spacing="12">
       <Border BackgroundColor="{StaticResource Primary}"
       WidthRequest="40"
        HeightRequest="40"
     VerticalOptions="Center">
         <Border.StrokeShape>
          <RoundRectangle CornerRadius="10" />
    </Border.StrokeShape>
  <Label Text="SD"
      FontSize="16"
           FontFamily="OpenSansSemibold"
  FontAttributes="Bold"
               TextColor="White"
      HorizontalOptions="Center"
            VerticalOptions="Center" />
      </Border>
            <VerticalStackLayout Spacing="2" VerticalOptions="Center">
   <Label Text="Server Data" 
              Style="{StaticResource HeaderLabel}" 
     FontSize="24" />
            <Label Text="Load and inspect events, teams, matches and scouting data" 
     Style="{StaticResource CaptionLabel}" 
              FontSize="13"
   Opacity="0.8" />
              </VerticalStackLayout>
       </HorizontalStackLayout>
          </VerticalStackLayout>
        </Border>

        <!-- MAIN CONTENT -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="20">

           <!-- CONTROLS CARD -->
            <Border Style="{StaticResource ModernCard}">
  <VerticalStackLayout Spacing="16">
        
 <!-- Search Bar -->
            <VerticalStackLayout Spacing="8">
 <Label Text="Search" Style="{StaticResource AccentLabel}" FontSize="14" />
  <Border BackgroundColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkSurfaceVariant}}"
 StrokeThickness="0"
               Padding="0">
          <Border.StrokeShape>
            <RoundRectangle CornerRadius="12" />
         </Border.StrokeShape>
          <Entry Placeholder="Search teams, events or matches" 
          Style="{StaticResource ModernEntry}"
         Text="{Binding Query}"
BackgroundColor="Transparent" />
      </Border>
           </VerticalStackLayout>

             <!-- Event Picker -->
             <VerticalStackLayout Spacing="8">
   <Label Text="Event Filter" Style="{StaticResource AccentLabel}" FontSize="14" />
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource LightSurfaceVariant}, Dark={StaticResource DarkSurfaceVariant}}"
      StrokeThickness="0"
           Padding="0">
      <Border.StrokeShape>
           <RoundRectangle CornerRadius="12" />
       </Border.StrokeShape>
           <Picker ItemsSource="{Binding Events}" 
             ItemDisplayBinding="{Binding Name}" 
          SelectedItem="{Binding SelectedEvent}"
     Style="{StaticResource ModernPicker}"
          BackgroundColor="Transparent"
        Title="Select Event" />
            </Border>
         </VerticalStackLayout>

                <!-- Action Buttons -->
       <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
       <Button Grid.Column="0"
      Text="Load All"
        Command="{Binding LoadAllCommand}"
        Style="{StaticResource PrimaryButton}" />
         <Button Grid.Column="1"
    Text="Refresh"
      Command="{Binding LoadAllCommand}"
   Style="{StaticResource OutlineButton}" />
               </Grid>

       </VerticalStackLayout>
        </Border>

    <!-- DATA SECTIONS IN RESPONSIVE GRID -->
          <Grid ColumnDefinitions="*,*" 
     RowDefinitions="Auto,Auto"
          ColumnSpacing="20" 
           RowSpacing="20">

            <!-- EVENTS SECTION -->
        <VerticalStackLayout Grid.Column="0" Grid.Row="0" Spacing="12">
     <HorizontalStackLayout Spacing="12">
       <Border BackgroundColor="{StaticResource Primary}"
    WidthRequest="32"
          HeightRequest="32"
              VerticalOptions="Center">
      <Border.StrokeShape>
     <RoundRectangle CornerRadius="8" />
    </Border.StrokeShape>
        <Label Text="E"
   FontSize="18"
   FontFamily="OpenSansSemibold"
        TextColor="White"
         HorizontalOptions="Center"
      VerticalOptions="Center" />
 </Border>
      <Label Text="Events" 
    Style="{StaticResource SectionHeader}" 
 FontSize="18"
          VerticalOptions="Center"
    Margin="0" />
    </HorizontalStackLayout>

   <StackLayout Spacing="12" BindableLayout.ItemsSource="{Binding Events}">
    <BindableLayout.ItemTemplate>
   <DataTemplate x:DataType="models:Event">
       <Border Style="{StaticResource ModernCard}" Padding="16">
         <VerticalStackLayout Spacing="6">
      <Label Text="{Binding Name}" 
  Style="{StaticResource SubheaderLabel}" 
         FontSize="16" />
      <HorizontalStackLayout Spacing="8">
        <Label Text="Location:"
       FontSize="11"
     FontFamily="OpenSansSemibold"
 TextColor="{AppThemeBinding Light={StaticResource LightTextTertiary}, Dark={StaticResource DarkTextTertiary}}"
       VerticalOptions="Center" />
           <Label Text="{Binding Location}" 
     Style="{StaticResource CaptionLabel}"
          FontSize="13"
    VerticalOptions="Center" />
  </HorizontalStackLayout>
    <HorizontalStackLayout Spacing="8">
     <Label Text="Date:"
FontSize="11"
     FontFamily="OpenSansSemibold"
      TextColor="{AppThemeBinding Light={StaticResource LightTextTertiary}, Dark={StaticResource DarkTextTertiary}}"
         VerticalOptions="Center" />
      <Label Text="{Binding StartDate, StringFormat='{0:MMM dd, yyyy}'}" 
      Style="{StaticResource CaptionLabel}"
        FontSize="13"
      VerticalOptions="Center" />
       </HorizontalStackLayout>
   </VerticalStackLayout>
      </Border>
  </DataTemplate>
    </BindableLayout.ItemTemplate>
</StackLayout>
           </VerticalStackLayout>

           <!-- TEAMS SECTION -->
  <VerticalStackLayout Grid.Column="1" Grid.Row="0" Spacing="12">
         <HorizontalStackLayout Spacing="12">
    <Border BackgroundColor="{StaticResource Secondary}"
  WidthRequest="32"
      HeightRequest="32"
     VerticalOptions="Center">
      <Border.StrokeShape>
       <RoundRectangle CornerRadius="8" />
         </Border.StrokeShape>
     <Label Text="T"
      FontSize="18"
    FontFamily="OpenSansSemibold"
 TextColor="White"
   HorizontalOptions="Center"
      VerticalOptions="Center" />
        </Border>
        <Label Text="Teams" 
 Style="{StaticResource SectionHeader}" 
        FontSize="18"
VerticalOptions="Center"
        Margin="0" />
 </HorizontalStackLayout>

     <StackLayout Spacing="12" BindableLayout.ItemsSource="{Binding Teams}">
            <BindableLayout.ItemTemplate>
         <DataTemplate x:DataType="models:Team">
      <Border Style="{StaticResource ModernCard}" Padding="16">
       <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
           <VerticalStackLayout Grid.Column="0" Spacing="6">
         <Label Text="{Binding TeamNumber, StringFormat='Team {0}'}" 
         Style="{StaticResource SubheaderLabel}" 
       FontSize="16" />
    <Label Text="{Binding TeamName}" 
      Style="{StaticResource BodyLabel}"
  FontSize="14"
             LineBreakMode="TailTruncation"
         MaxLines="1" />
  <HorizontalStackLayout Spacing="8">
           <Label Text="Location:"
  FontSize="10"
       FontFamily="OpenSansSemibold"
        TextColor="{AppThemeBinding Light={StaticResource LightTextTertiary}, Dark={StaticResource DarkTextTertiary}}"
VerticalOptions="Center" />
     <Label Text="{Binding Location}" 
   Style="{StaticResource CaptionLabel}"
      FontSize="12"
 VerticalOptions="Center" />
      </HorizontalStackLayout>
        </VerticalStackLayout>
                
    <Border Grid.Column="1"
    Style="{StaticResource Badge}"
                   VerticalOptions="Center"
     IsVisible="{Binding ScoutingDataCount, Converter={StaticResource IntToBoolConverter}}">
          <Label Text="{Binding ScoutingDataCount, StringFormat='{0}'}"
    TextColor="White"
            FontSize="14"
          FontAttributes="Bold" />
      </Border>
    </Grid>
         </Border>
         </DataTemplate>
        </BindableLayout.ItemTemplate>
    </StackLayout>
   </VerticalStackLayout>

  <!-- MATCHES SECTION -->
        <VerticalStackLayout Grid.Column="0" Grid.Row="1" Spacing="12">
          <HorizontalStackLayout Spacing="12">
     <Label Text="Matches" 
 Style="{StaticResource SectionHeader}" 
       FontSize="18"
               VerticalOptions="Center"
        Margin="0" />
       </HorizontalStackLayout>

<StackLayout Spacing="12" BindableLayout.ItemsSource="{Binding Matches}">
      <BindableLayout.ItemTemplate>
                <DataTemplate x:DataType="models:MatchCard">
     <Border Style="{StaticResource ModernCard}" Padding="16">
       <VerticalStackLayout Spacing="6">
    <Label Text="{Binding EventName}" 
               Style="{StaticResource SubheaderLabel}" 
      FontSize="16" />
      <Label Text="{Binding Match.MatchNumber, StringFormat='Match #{0}'}" 
          Style="{StaticResource CaptionLabel}"
         FontSize="13" />
            <HorizontalStackLayout Spacing="8">
            <Label Text="🔴" FontSize="12" VerticalOptions="Center" />
       <Label Text="{Binding Match.RedAlliance}" 
 Style="{StaticResource BodyLabel}"
       FontSize="13"
        VerticalOptions="Center" />
           </HorizontalStackLayout>
 </VerticalStackLayout>
        </Border>
                  </DataTemplate>
          </BindableLayout.ItemTemplate>
     </StackLayout>
           </VerticalStackLayout>

    <!-- SCOUTING SECTION -->
     <VerticalStackLayout Grid.Column="1" Grid.Row="1" Spacing="12">
           <HorizontalStackLayout Spacing="12">
            <Label Text="Scouting" 
          Style="{StaticResource SectionHeader}" 
FontSize="18"
       VerticalOptions="Center"
     Margin="0" />
        </HorizontalStackLayout>

              <StackLayout Spacing="12" BindableLayout.ItemsSource="{Binding Scouting}">
        <BindableLayout.ItemTemplate>
    <DataTemplate x:DataType="models:ScoutingEntry">
          <Border Style="{StaticResource ModernCard}" Padding="16">
<VerticalStackLayout Spacing="8">
       <HorizontalStackLayout Spacing="12">
                  <Label Text="{Binding TeamNumber, StringFormat='Team {0}'}" 
       Style="{StaticResource SubheaderLabel}" 
        FontSize="16" />
            <Label Text="{Binding MatchNumber, StringFormat='M{0}'}" 
       Style="{StaticResource CaptionLabel}"
        FontSize="12"
      VerticalOptions="Center"
            HorizontalOptions="EndAndExpand" />
  </HorizontalStackLayout>
       <Label Text="{Binding TeamName}" 
           Style="{StaticResource BodyLabel}"
        FontSize="14" />
    <HorizontalStackLayout Spacing="8">
             <Label Text="👤" FontSize="11" VerticalOptions="Center" />
           <Label Text="{Binding ScoutName}" 
           Style="{StaticResource CaptionLabel}"
      FontSize="12"
  VerticalOptions="Center" />
   </HorizontalStackLayout>
     <Label Text="{Binding Timestamp, StringFormat='{0:MMM dd, HH:mm}'}" 
          Style="{StaticResource CaptionLabel}"
         FontSize="11"
           Opacity="0.7" />
        </VerticalStackLayout>
  </Border>
         </DataTemplate>
     </BindableLayout.ItemTemplate>
               </StackLayout>
           </VerticalStackLayout>

      </Grid>

      <!-- QUICK FILTER SECTION -->
    <Border Style="{StaticResource CompactGlassCard}">
         <VerticalStackLayout Spacing="12">
    <Label Text="Quick Filters" 
   Style="{StaticResource AccentLabel}" 
       FontSize="14" />
 <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="8">
<Button Grid.Column="0"
                 Text="Events"
     Command="{Binding ShowSectionCommand}"
  CommandParameter="events"
           Style="{StaticResource GhostButton}"
      FontSize="13"
  Padding="12,8" />
       <Button Grid.Column="1"
       Text="Teams"
      Command="{Binding ShowSectionCommand}"
          CommandParameter="teams"
                 Style="{StaticResource GhostButton}"
         FontSize="13"
       Padding="12,8" />
      <Button Grid.Column="2"
          Text="Matches"
    Command="{Binding ShowSectionCommand}"
        CommandParameter="matches"
            Style="{StaticResource GhostButton}"
            FontSize="13"
          Padding="12,8" />
 <Button Grid.Column="3"
       Text="Scouting"
        Command="{Binding ShowSectionCommand}"
  CommandParameter="scouting"
  Style="{StaticResource GhostButton}"
           FontSize="13"
    Padding="12,8" />
           </Grid>
           </VerticalStackLayout>
    </Border>

     <!-- Bottom Spacing -->
        <BoxView HeightRequest="20" BackgroundColor="Transparent" />

        </VerticalStackLayout>
        </ScrollView>

     <!-- FAB Refresh Button -->
     <Button Grid.Row="1"
  Style="{StaticResource FAB}"
    Command="{Binding LoadAllCommand}"
 Text="↻"
     HorizontalOptions="End"
    VerticalOptions="End"
        Margin="0,0,0,20" />

    </Grid>
</ContentPage>
